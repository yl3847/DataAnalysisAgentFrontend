{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n// Only use one instance.\nlet canvas;\n/**\n * Create a canvas instance.\n * @param width - width\n * @param height - height\n * @returns a new Canvas\n */\nfunction createCanvas(width, height) {\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n  }\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  ctx.clearRect(0, 0, width, height);\n  return canvas;\n}\n/**\n * 从文本获取水印的 base64\n * @param width - width\n * @param height - height\n * @param text - 样式\n * @param style - 样式\n * @returns 水印的 base64\n */\nexport function getTextWatermark(width, height, text, style) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const canvas = createCanvas(width, height);\n    const ctx = canvas.getContext('2d');\n    const {\n      rotate,\n      opacity,\n      textFill,\n      textFontSize,\n      textFontFamily,\n      textFontVariant,\n      textFontWeight,\n      textAlign,\n      textBaseline\n    } = style;\n    // Set the style.\n    // Default is align center and middle.\n    ctx.textAlign = textAlign;\n    ctx.textBaseline = textBaseline;\n    ctx.translate(width / 2, height / 2);\n    ctx.font = `${textFontSize}px ${textFontFamily} ${textFontVariant} ${textFontWeight}`;\n    rotate && ctx.rotate(rotate);\n    opacity && (ctx.globalAlpha = opacity);\n    if (textFill) {\n      ctx.fillStyle = textFill;\n      // Draw the text.\n      ctx.fillText(`${text}`, 0, 0);\n    }\n    // Return the base64.\n    return canvas.toDataURL();\n  });\n}\n/**\n * Get the image base64 of the watermark.\n * @param width - width\n * @param height - height\n * @param imageURL - image URL\n * @param style - 样式\n * @returns 水印的 base64\n */\nexport function getImageWatermark(width, height, imageURL, style) {\n  return __awaiter(this, void 0, void 0, function* () {\n    const canvas = createCanvas(width, height);\n    const ctx = canvas.getContext('2d');\n    const {\n      rotate,\n      opacity\n    } = style;\n    rotate && ctx.rotate(rotate);\n    opacity && (ctx.globalAlpha = opacity);\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.src = imageURL;\n    return new Promise(resolve => {\n      img.onload = function () {\n        const sepX = width > img.width ? (width - img.width) / 2 : 0;\n        const sepY = height > img.height ? (height - img.height) / 2 : 0;\n        ctx.drawImage(img, 0, 0, img.width, img.height, sepX, sepY, width - sepX * 2, height - sepY * 2);\n        resolve(canvas.toDataURL());\n      };\n    });\n  });\n}","map":{"version":3,"names":["canvas","createCanvas","width","height","document","createElement","ctx","getContext","clearRect","getTextWatermark","text","style","rotate","opacity","textFill","textFontSize","textFontFamily","textFontVariant","textFontWeight","textAlign","textBaseline","translate","font","globalAlpha","fillStyle","fillText","toDataURL","getImageWatermark","imageURL","img","Image","crossOrigin","src","Promise","resolve","onload","sepX","sepY","drawImage"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/g6/src/plugins/watermark/util.ts"],"sourcesContent":["// Only use one instance.\nlet canvas: HTMLCanvasElement;\n\n/**\n * Create a canvas instance.\n * @param width - width\n * @param height - height\n * @returns a new Canvas\n */\nfunction createCanvas(width: number, height: number): HTMLCanvasElement {\n  if (!canvas) {\n    canvas = document.createElement('canvas');\n  }\n  canvas.width = width;\n  canvas.height = height;\n  const ctx = canvas.getContext('2d');\n  ctx!.clearRect(0, 0, width, height);\n  return canvas;\n}\n\n/**\n * 从文本获取水印的 base64\n * @param width - width\n * @param height - height\n * @param text - 样式\n * @param style - 样式\n * @returns 水印的 base64\n */\nexport async function getTextWatermark(width: number, height: number, text: string, style: any) {\n  const canvas = createCanvas(width, height);\n  const ctx = canvas.getContext('2d')!;\n\n  const {\n    rotate,\n    opacity,\n    textFill,\n    textFontSize,\n    textFontFamily,\n    textFontVariant,\n    textFontWeight,\n    textAlign,\n    textBaseline,\n  } = style;\n\n  // Set the style.\n  // Default is align center and middle.\n  ctx.textAlign = textAlign;\n  ctx.textBaseline = textBaseline;\n  ctx.translate(width / 2, height / 2);\n\n  ctx.font = `${textFontSize}px ${textFontFamily} ${textFontVariant} ${textFontWeight}`;\n\n  rotate && ctx.rotate(rotate);\n  opacity && (ctx.globalAlpha = opacity);\n  if (textFill) {\n    ctx.fillStyle = textFill;\n    // Draw the text.\n    ctx.fillText(`${text}`, 0, 0);\n  }\n\n  // Return the base64.\n  return canvas.toDataURL();\n}\n\n/**\n * Get the image base64 of the watermark.\n * @param width - width\n * @param height - height\n * @param imageURL - image URL\n * @param style - 样式\n * @returns 水印的 base64\n */\nexport async function getImageWatermark(width: number, height: number, imageURL: string, style: any) {\n  const canvas = createCanvas(width, height);\n  const ctx = canvas.getContext('2d')!;\n  const { rotate, opacity } = style;\n\n  rotate && ctx.rotate(rotate);\n  opacity && (ctx.globalAlpha = opacity);\n\n  const img = new Image();\n  img.crossOrigin = 'anonymous';\n  img.src = imageURL;\n\n  return new Promise((resolve) => {\n    img.onload = function () {\n      const sepX = width > img.width ? (width - img.width) / 2 : 0;\n      const sepY = height > img.height ? (height - img.height) / 2 : 0;\n      ctx.drawImage(img, 0, 0, img.width, img.height, sepX, sepY, width - sepX * 2, height - sepY * 2);\n      resolve(canvas.toDataURL());\n    };\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}