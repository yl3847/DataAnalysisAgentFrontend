{"ast":null,"code":"import { deepMix } from '@antv/util';\nimport { rollups, sum } from '@antv/vendor/d3-array';\nimport { columnOf } from './utils/helper';\nfunction valueOf(data, field) {\n  if (typeof field === 'string') return data.map(d => d[field]);\n  return data.map(field);\n}\nfunction createReducer(reducer, V) {\n  if (typeof reducer === 'function') return GI => reducer(GI, V);\n  if (reducer === 'sum') return GI => sum(GI, i => +V[i]);\n  throw new Error(`Unknown reducer: ${reducer}`);\n}\n/**\n * Produce flex options from data for x scale.\n */\nexport const FlexX = (options = {}) => {\n  const {\n    field,\n    channel = 'y',\n    reducer = 'sum'\n  } = options;\n  return (I, mark) => {\n    const {\n      data,\n      encode\n    } = mark;\n    const [x] = columnOf(encode, 'x');\n    const V = field ? valueOf(data, field) : columnOf(encode, channel)[0];\n    const reducerFunction = createReducer(reducer, V);\n    const flex = rollups(I, reducerFunction, i => x[i]).map(d => d[1]);\n    return [I, deepMix({}, mark, {\n      scale: {\n        x: {\n          flex\n        }\n      }\n    })];\n  };\n};\nFlexX.props = {};","map":{"version":3,"names":["deepMix","rollups","sum","columnOf","valueOf","data","field","map","d","createReducer","reducer","V","GI","i","Error","FlexX","options","channel","I","mark","encode","x","reducerFunction","flex","scale","props"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/g2/src/transform/flexX.ts"],"sourcesContent":["import { deepMix } from '@antv/util';\nimport { rollups, sum, Primitive } from '@antv/vendor/d3-array';\nimport { TransformComponent as TC } from '../runtime';\nimport { FlexXTransform } from '../spec';\nimport { columnOf } from './utils/helper';\n\nexport type FlexXOptions = Omit<FlexXTransform, 'type'>;\n\nfunction valueOf(data: any, field: FlexXOptions['field']) {\n  if (typeof field === 'string') return data.map((d) => d[field]);\n  return data.map(field);\n}\n\nfunction createReducer(\n  reducer: FlexXOptions['reducer'],\n  V: Primitive[],\n): (I: number[]) => any {\n  if (typeof reducer === 'function') return (GI: number[]) => reducer(GI, V);\n  if (reducer === 'sum') return (GI: number[]) => sum(GI, (i) => +V[i]);\n  throw new Error(`Unknown reducer: ${reducer}`);\n}\n\n/**\n * Produce flex options from data for x scale.\n */\nexport const FlexX: TC<FlexXOptions> = (options = {}) => {\n  const { field, channel = 'y', reducer = 'sum' } = options;\n  return (I, mark) => {\n    const { data, encode } = mark;\n    const [x] = columnOf(encode, 'x');\n    const V = field ? valueOf(data, field) : columnOf(encode, channel)[0];\n    const reducerFunction = createReducer(reducer, V);\n    const flex = rollups(I, reducerFunction, (i) => x[i]).map((d) => d[1]);\n    return [I, deepMix({}, mark, { scale: { x: { flex } } })];\n  };\n};\n\nFlexX.props = {};\n"],"mappings":"AAAA,SAASA,OAAO,QAAQ,YAAY;AACpC,SAASC,OAAO,EAAEC,GAAG,QAAmB,uBAAuB;AAG/D,SAASC,QAAQ,QAAQ,gBAAgB;AAIzC,SAASC,OAAOA,CAACC,IAAS,EAAEC,KAA4B;EACtD,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE,OAAOD,IAAI,CAACE,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAACF,KAAK,CAAC,CAAC;EAC/D,OAAOD,IAAI,CAACE,GAAG,CAACD,KAAK,CAAC;AACxB;AAEA,SAASG,aAAaA,CACpBC,OAAgC,EAChCC,CAAc;EAEd,IAAI,OAAOD,OAAO,KAAK,UAAU,EAAE,OAAQE,EAAY,IAAKF,OAAO,CAACE,EAAE,EAAED,CAAC,CAAC;EAC1E,IAAID,OAAO,KAAK,KAAK,EAAE,OAAQE,EAAY,IAAKV,GAAG,CAACU,EAAE,EAAGC,CAAC,IAAK,CAACF,CAAC,CAACE,CAAC,CAAC,CAAC;EACrE,MAAM,IAAIC,KAAK,CAAC,oBAAoBJ,OAAO,EAAE,CAAC;AAChD;AAEA;;;AAGA,OAAO,MAAMK,KAAK,GAAqBA,CAACC,OAAO,GAAG,EAAE,KAAI;EACtD,MAAM;IAAEV,KAAK;IAAEW,OAAO,GAAG,GAAG;IAAEP,OAAO,GAAG;EAAK,CAAE,GAAGM,OAAO;EACzD,OAAO,CAACE,CAAC,EAAEC,IAAI,KAAI;IACjB,MAAM;MAAEd,IAAI;MAAEe;IAAM,CAAE,GAAGD,IAAI;IAC7B,MAAM,CAACE,CAAC,CAAC,GAAGlB,QAAQ,CAACiB,MAAM,EAAE,GAAG,CAAC;IACjC,MAAMT,CAAC,GAAGL,KAAK,GAAGF,OAAO,CAACC,IAAI,EAAEC,KAAK,CAAC,GAAGH,QAAQ,CAACiB,MAAM,EAAEH,OAAO,CAAC,CAAC,CAAC,CAAC;IACrE,MAAMK,eAAe,GAAGb,aAAa,CAACC,OAAO,EAAEC,CAAC,CAAC;IACjD,MAAMY,IAAI,GAAGtB,OAAO,CAACiB,CAAC,EAAEI,eAAe,EAAGT,CAAC,IAAKQ,CAAC,CAACR,CAAC,CAAC,CAAC,CAACN,GAAG,CAAEC,CAAC,IAAKA,CAAC,CAAC,CAAC,CAAC,CAAC;IACtE,OAAO,CAACU,CAAC,EAAElB,OAAO,CAAC,EAAE,EAAEmB,IAAI,EAAE;MAAEK,KAAK,EAAE;QAAEH,CAAC,EAAE;UAAEE;QAAI;MAAE;IAAE,CAAE,CAAC,CAAC;EAC3D,CAAC;AACH,CAAC;AAEDR,KAAK,CAACU,KAAK,GAAG,EAAE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}