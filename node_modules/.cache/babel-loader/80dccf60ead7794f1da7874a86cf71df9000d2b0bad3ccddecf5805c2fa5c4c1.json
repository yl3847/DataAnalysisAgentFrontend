{"ast":null,"code":"import { __assign, __extends, __read } from \"tslib\";\nimport { Component } from '../../core';\nimport { BBox, select, splitStyle, subStyleProps } from '../../util';\nimport { getBBox, Title } from '../title';\nimport { CategoryItems } from './category/items';\nimport { CATEGORY_DEFAULT_OPTIONS, CLASS_NAMES } from './constant';\nvar Category = /** @class */function (_super) {\n  __extends(Category, _super);\n  function Category(options) {\n    return _super.call(this, options, CATEGORY_DEFAULT_OPTIONS) || this;\n  }\n  Category.prototype.renderTitle = function (container, width, height) {\n    var _a = this.attributes,\n      showTitle = _a.showTitle,\n      titleText = _a.titleText;\n    var style = subStyleProps(this.attributes, 'title');\n    var _b = __read(splitStyle(style), 2),\n      titleStyle = _b[0],\n      groupStyle = _b[1];\n    this.titleGroup = container.maybeAppendByClassName(CLASS_NAMES.titleGroup, 'g').styles(groupStyle);\n    var finalTitleStyle = __assign(__assign({\n      width: width,\n      height: height\n    }, titleStyle), {\n      text: showTitle ? titleText : ''\n    });\n    this.title = this.titleGroup.maybeAppendByClassName(CLASS_NAMES.title, function () {\n      return new Title({\n        style: finalTitleStyle\n      });\n    }).update(finalTitleStyle);\n  };\n  Category.prototype.renderItems = function (container, bbox) {\n    var x = bbox.x,\n      y = bbox.y,\n      width = bbox.width,\n      height = bbox.height;\n    var style = subStyleProps(this.attributes, 'title', true);\n    var _a = __read(splitStyle(style), 2),\n      partialItemStyle = _a[0],\n      groupStyle = _a[1];\n    // overwrite width and height to available space\n    // overwrite x and y to 0\n    var itemStyle = __assign(__assign({}, partialItemStyle), {\n      width: width,\n      height: height,\n      x: 0,\n      y: 0\n    });\n    this.itemsGroup = container.maybeAppendByClassName(CLASS_NAMES.itemsGroup, 'g').styles(__assign(__assign({}, groupStyle), {\n      transform: \"translate(\".concat(x, \", \").concat(y, \")\")\n    }));\n    var that = this;\n    this.itemsGroup.selectAll(CLASS_NAMES.items.class).data(['items']).join(function (enter) {\n      return enter.append(function () {\n        return new CategoryItems({\n          style: itemStyle\n        });\n      }).attr('className', CLASS_NAMES.items.name).each(function () {\n        that.items = select(this);\n      });\n    }, function (update) {\n      return update.update(itemStyle);\n    }, function (exit) {\n      return exit.remove();\n    });\n  };\n  Category.prototype.adjustLayout = function () {\n    var showTitle = this.attributes.showTitle;\n    if (showTitle) {\n      var _a = this.title.node().getAvailableSpace(),\n        x = _a.x,\n        y = _a.y;\n      this.itemsGroup.node().style.transform = \"translate(\".concat(x, \", \").concat(y, \")\");\n    }\n  };\n  Object.defineProperty(Category.prototype, \"availableSpace\", {\n    get: function () {\n      var _a = this.attributes,\n        showTitle = _a.showTitle,\n        width = _a.width,\n        height = _a.height;\n      if (!showTitle) return new BBox(0, 0, width, height);\n      return this.title.node().getAvailableSpace();\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Category.prototype.getBBox = function () {\n    var _a, _b;\n    var title = (_a = this.title) === null || _a === void 0 ? void 0 : _a.node();\n    var items = (_b = this.items) === null || _b === void 0 ? void 0 : _b.node();\n    if (!title || !items) return _super.prototype.getBBox.call(this);\n    return getBBox(title, items);\n  };\n  Category.prototype.render = function (attributes, container) {\n    var _a = this.attributes,\n      width = _a.width,\n      height = _a.height,\n      _b = _a.x,\n      x = _b === void 0 ? 0 : _b,\n      _c = _a.y,\n      y = _c === void 0 ? 0 : _c;\n    var ctn = select(container);\n    container.style.transform = \"translate(\".concat(x, \", \").concat(y, \")\");\n    this.renderTitle(ctn, width, height);\n    this.renderItems(ctn, this.availableSpace);\n    this.adjustLayout();\n  };\n  return Category;\n}(Component);\nexport { Category };","map":{"version":3,"names":["Component","BBox","select","splitStyle","subStyleProps","getBBox","Title","CategoryItems","CATEGORY_DEFAULT_OPTIONS","CLASS_NAMES","Category","_super","__extends","options","call","prototype","renderTitle","container","width","height","_a","attributes","showTitle","titleText","style","_b","__read","titleStyle","groupStyle","titleGroup","maybeAppendByClassName","styles","finalTitleStyle","__assign","text","title","update","renderItems","bbox","x","y","partialItemStyle","itemStyle","itemsGroup","transform","concat","that","selectAll","items","class","data","join","enter","append","attr","name","each","exit","remove","adjustLayout","node","getAvailableSpace","Object","defineProperty","get","render","_c","ctn","availableSpace"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/component/src/ui/legend/category.ts"],"sourcesContent":["import { Component } from '../../core';\nimport type { Group } from '../../shapes';\nimport { BBox, select, Selection, splitStyle, subStyleProps } from '../../util';\nimport type { TitleStyleProps } from '../title';\nimport { getBBox, Title } from '../title';\nimport { CategoryItems } from './category/items';\nimport { CATEGORY_DEFAULT_OPTIONS, CLASS_NAMES } from './constant';\nimport type { CategoryOptions, CategoryStyleProps } from './types';\n\nexport type { CategoryOptions, CategoryStyleProps };\n\nexport class Category extends Component<CategoryStyleProps> {\n  constructor(options: CategoryOptions) {\n    super(options, CATEGORY_DEFAULT_OPTIONS);\n  }\n\n  private titleGroup!: Selection;\n\n  private title!: Selection<Title>;\n\n  private itemsGroup!: Selection;\n\n  private items!: Selection<CategoryItems>;\n\n  private renderTitle(container: Selection, width: number, height: number) {\n    const { showTitle, titleText } = this.attributes;\n    const style = subStyleProps<TitleStyleProps>(this.attributes, 'title');\n    const [titleStyle, groupStyle] = splitStyle(style);\n\n    this.titleGroup = container.maybeAppendByClassName<Group>(CLASS_NAMES.titleGroup, 'g').styles(groupStyle);\n\n    const finalTitleStyle = { width, height, ...titleStyle, text: showTitle ? titleText : '' };\n    this.title = this.titleGroup\n      .maybeAppendByClassName(CLASS_NAMES.title, () => new Title({ style: finalTitleStyle as TitleStyleProps }))\n      .update(finalTitleStyle) as Selection<Title>;\n  }\n\n  private renderItems(container: Selection, bbox: DOMRect) {\n    const { x, y, width, height } = bbox;\n    const style = subStyleProps(this.attributes, 'title', true);\n    const [partialItemStyle, groupStyle] = splitStyle(style);\n    // overwrite width and height to available space\n    // overwrite x and y to 0\n    const itemStyle = { ...partialItemStyle, width, height, x: 0, y: 0 } as CategoryStyleProps;\n    this.itemsGroup = container\n      .maybeAppendByClassName<Group>(CLASS_NAMES.itemsGroup, 'g')\n      .styles({ ...groupStyle, transform: `translate(${x}, ${y})` });\n    const that = this;\n    this.itemsGroup\n      .selectAll(CLASS_NAMES.items.class)\n      .data(['items'])\n      .join(\n        (enter) =>\n          enter\n            .append(() => new CategoryItems({ style: itemStyle }))\n            .attr('className', CLASS_NAMES.items.name)\n            .each(function () {\n              that.items = select(this);\n            }),\n        (update) => update.update(itemStyle),\n        (exit) => exit.remove()\n      );\n  }\n\n  private adjustLayout() {\n    const { showTitle } = this.attributes;\n    if (showTitle) {\n      const { x, y } = this.title.node<Title>().getAvailableSpace();\n      this.itemsGroup.node().style.transform = `translate(${x}, ${y})`;\n    }\n  }\n\n  private get availableSpace(): DOMRect {\n    const { showTitle, width, height } = this.attributes;\n    if (!showTitle) return new BBox(0, 0, width!, height!);\n    return (this.title.node() as Title).getAvailableSpace();\n  }\n\n  public getBBox(): DOMRect {\n    const title: Title = this.title?.node();\n    const items = this.items?.node();\n    if (!title || !items) return super.getBBox();\n    return getBBox(title, items);\n  }\n\n  render(attributes: Required<CategoryStyleProps>, container: Group) {\n    const { width, height, x = 0, y = 0 } = this.attributes;\n    const ctn = select(container);\n    container.style.transform = `translate(${x}, ${y})`;\n\n    this.renderTitle(ctn, width!, height!);\n\n    this.renderItems(ctn, this.availableSpace);\n\n    this.adjustLayout();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}