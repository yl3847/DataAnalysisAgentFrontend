{"ast":null,"code":"var __rest = this && this.__rest || function (s, e) {\n  var t = {};\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\nimport { deepMix, isArray } from '@antv/util';\nimport { stratify, hierarchy, pack as packLayout } from '@antv/vendor/d3-hierarchy';\nimport { subObject } from '../utils/helper';\nimport { maybeTooltip } from '../utils/mark';\nimport { field } from './utils';\nconst GET_DEFAULT_LAYOUT_OPTIONS = (width, height) => ({\n  size: [width, height],\n  padding: 0,\n  sort: (a, b) => b.value - a.value\n});\nconst GET_DEFAULT_OPTIONS = (width, height, encode) => ({\n  type: 'point',\n  axis: false,\n  legend: false,\n  scale: {\n    x: {\n      domain: [0, width]\n    },\n    y: {\n      domain: [0, height]\n    },\n    size: {\n      type: 'identity'\n    }\n  },\n  encode: {\n    x: 'x',\n    y: 'y',\n    size: 'r',\n    shape: 'point'\n  },\n  style: {\n    fill: !encode.color ? d => d.height === 0 ? '#ddd' : '#fff' : undefined,\n    stroke: !encode.color ? d => d.height === 0 ? '' : '#000' : undefined\n  }\n});\nconst DEFAULT_LABEL_OPTIONS = {\n  text: '',\n  position: 'inside',\n  textOverflow: 'clip',\n  wordWrap: true,\n  maxLines: 1,\n  wordWrapWidth: d => d.r * 2\n};\nconst DEFAULT_TOOLTIP_OPTIONS = {\n  title: d => d.data.name,\n  items: [{\n    field: 'value'\n  }]\n};\nconst dataTransform = (data, layout, encode) => {\n  const {\n    value\n  } = encode;\n  const root = isArray(data) ? stratify().path(layout.path)(data) : hierarchy(data);\n  value ? root.sum(d => field(value)(d)).sort(layout.sort) : root.count();\n  // @ts-ignore\n  packLayout().size(layout.size).padding(layout.padding)(root);\n  return root.descendants();\n};\nexport const Pack = (markOptions, context) => {\n  const {\n    width,\n    height\n  } = context;\n  const {\n      data,\n      encode = {},\n      scale = {},\n      style = {},\n      layout = {},\n      labels = [],\n      tooltip = {}\n    } = markOptions,\n    resOptions = __rest(markOptions, [\"data\", \"encode\", \"scale\", \"style\", \"layout\", \"labels\", \"tooltip\"]);\n  const DEFAULT_OPTIONS = GET_DEFAULT_OPTIONS(width, height, encode);\n  const transformedData = dataTransform(data, deepMix({}, GET_DEFAULT_LAYOUT_OPTIONS(width, height), layout), deepMix({}, DEFAULT_OPTIONS['encode'], encode));\n  const labelStyle = subObject(style, 'label');\n  return deepMix({}, DEFAULT_OPTIONS, Object.assign(Object.assign({\n    data: transformedData,\n    encode,\n    scale,\n    style,\n    labels: [Object.assign(Object.assign({}, DEFAULT_LABEL_OPTIONS), labelStyle), ...labels]\n  }, resOptions), {\n    tooltip: maybeTooltip(tooltip, DEFAULT_TOOLTIP_OPTIONS),\n    axis: false\n  }));\n};\nPack.props = {};","map":{"version":3,"names":["deepMix","isArray","stratify","hierarchy","pack","packLayout","subObject","maybeTooltip","field","GET_DEFAULT_LAYOUT_OPTIONS","width","height","size","padding","sort","a","b","value","GET_DEFAULT_OPTIONS","encode","type","axis","legend","scale","x","domain","y","shape","style","fill","color","d","undefined","stroke","DEFAULT_LABEL_OPTIONS","text","position","textOverflow","wordWrap","maxLines","wordWrapWidth","r","DEFAULT_TOOLTIP_OPTIONS","title","data","name","items","dataTransform","layout","root","path","sum","count","descendants","Pack","markOptions","context","labels","tooltip","resOptions","__rest","DEFAULT_OPTIONS","transformedData","labelStyle","Object","assign","props"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/g2/src/mark/pack.ts"],"sourcesContent":["import { deepMix, isArray } from '@antv/util';\nimport {\n  stratify,\n  hierarchy,\n  pack as packLayout,\n} from '@antv/vendor/d3-hierarchy';\nimport { CompositionComponent as CC } from '../runtime';\nimport { subObject } from '../utils/helper';\nimport { PackMark } from '../spec';\nimport { maybeTooltip } from '../utils/mark';\nimport { field } from './utils';\n\nconst GET_DEFAULT_LAYOUT_OPTIONS = (width, height) => ({\n  size: [width, height],\n  padding: 0,\n  sort: (a, b) => b.value - a.value,\n});\n\nconst GET_DEFAULT_OPTIONS = (width, height, encode) => ({\n  type: 'point',\n  axis: false,\n  legend: false,\n  scale: {\n    x: { domain: [0, width] },\n    y: { domain: [0, height] },\n    size: { type: 'identity' },\n  },\n  encode: {\n    x: 'x',\n    y: 'y',\n    size: 'r',\n    shape: 'point',\n  },\n  style: {\n    fill: !encode.color ? (d) => (d.height === 0 ? '#ddd' : '#fff') : undefined,\n    stroke: !encode.color ? (d) => (d.height === 0 ? '' : '#000') : undefined,\n  },\n});\n\nconst DEFAULT_LABEL_OPTIONS = {\n  text: '',\n  position: 'inside',\n  textOverflow: 'clip',\n  wordWrap: true,\n  maxLines: 1,\n  wordWrapWidth: (d) => d.r * 2,\n};\nconst DEFAULT_TOOLTIP_OPTIONS = {\n  title: (d) => d.data.name,\n  items: [{ field: 'value' }],\n};\n\ntype PackLayout = {\n  size?: [number, number];\n  padding?: number;\n  sort?(a: any, b: any): number;\n  // @todo\n  path?: any;\n};\n\nconst dataTransform = (data, layout: PackLayout, encode) => {\n  const { value } = encode;\n  const root = isArray(data)\n    ? stratify().path(layout.path)(data)\n    : hierarchy(data);\n  value ? root.sum((d) => field(value)(d)).sort(layout.sort) : root.count();\n  // @ts-ignore\n  packLayout().size(layout.size).padding(layout.padding)(root);\n  return root.descendants();\n};\n\nexport type PackOptions = Omit<PackMark, 'type'>;\n\nexport const Pack: CC<PackOptions> = (markOptions, context) => {\n  const { width, height } = context;\n\n  const {\n    data,\n    encode = {},\n    scale = {},\n    style = {},\n    layout = {},\n    labels = [],\n    tooltip = {},\n    ...resOptions\n  } = markOptions;\n\n  const DEFAULT_OPTIONS = GET_DEFAULT_OPTIONS(width, height, encode);\n\n  const transformedData = dataTransform(\n    data,\n    deepMix({}, GET_DEFAULT_LAYOUT_OPTIONS(width, height), layout),\n    deepMix({}, DEFAULT_OPTIONS['encode'], encode),\n  );\n\n  const labelStyle = subObject(style, 'label');\n\n  return deepMix({}, DEFAULT_OPTIONS, {\n    data: transformedData,\n    encode,\n    scale,\n    style,\n    labels: [\n      {\n        ...DEFAULT_LABEL_OPTIONS,\n        ...labelStyle,\n      },\n      ...labels,\n    ],\n    ...resOptions,\n    tooltip: maybeTooltip(tooltip, DEFAULT_TOOLTIP_OPTIONS),\n    axis: false,\n  });\n};\n\nPack.props = {};\n"],"mappings":";;;;;;;;AAAA,SAASA,OAAO,EAAEC,OAAO,QAAQ,YAAY;AAC7C,SACEC,QAAQ,EACRC,SAAS,EACTC,IAAI,IAAIC,UAAU,QACb,2BAA2B;AAElC,SAASC,SAAS,QAAQ,iBAAiB;AAE3C,SAASC,YAAY,QAAQ,eAAe;AAC5C,SAASC,KAAK,QAAQ,SAAS;AAE/B,MAAMC,0BAA0B,GAAGA,CAACC,KAAK,EAAEC,MAAM,MAAM;EACrDC,IAAI,EAAE,CAACF,KAAK,EAAEC,MAAM,CAAC;EACrBE,OAAO,EAAE,CAAC;EACVC,IAAI,EAAEA,CAACC,CAAC,EAAEC,CAAC,KAAKA,CAAC,CAACC,KAAK,GAAGF,CAAC,CAACE;CAC7B,CAAC;AAEF,MAAMC,mBAAmB,GAAGA,CAACR,KAAK,EAAEC,MAAM,EAAEQ,MAAM,MAAM;EACtDC,IAAI,EAAE,OAAO;EACbC,IAAI,EAAE,KAAK;EACXC,MAAM,EAAE,KAAK;EACbC,KAAK,EAAE;IACLC,CAAC,EAAE;MAAEC,MAAM,EAAE,CAAC,CAAC,EAAEf,KAAK;IAAC,CAAE;IACzBgB,CAAC,EAAE;MAAED,MAAM,EAAE,CAAC,CAAC,EAAEd,MAAM;IAAC,CAAE;IAC1BC,IAAI,EAAE;MAAEQ,IAAI,EAAE;IAAU;GACzB;EACDD,MAAM,EAAE;IACNK,CAAC,EAAE,GAAG;IACNE,CAAC,EAAE,GAAG;IACNd,IAAI,EAAE,GAAG;IACTe,KAAK,EAAE;GACR;EACDC,KAAK,EAAE;IACLC,IAAI,EAAE,CAACV,MAAM,CAACW,KAAK,GAAIC,CAAC,IAAMA,CAAC,CAACpB,MAAM,KAAK,CAAC,GAAG,MAAM,GAAG,MAAO,GAAGqB,SAAS;IAC3EC,MAAM,EAAE,CAACd,MAAM,CAACW,KAAK,GAAIC,CAAC,IAAMA,CAAC,CAACpB,MAAM,KAAK,CAAC,GAAG,EAAE,GAAG,MAAO,GAAGqB;;CAEnE,CAAC;AAEF,MAAME,qBAAqB,GAAG;EAC5BC,IAAI,EAAE,EAAE;EACRC,QAAQ,EAAE,QAAQ;EAClBC,YAAY,EAAE,MAAM;EACpBC,QAAQ,EAAE,IAAI;EACdC,QAAQ,EAAE,CAAC;EACXC,aAAa,EAAGT,CAAC,IAAKA,CAAC,CAACU,CAAC,GAAG;CAC7B;AACD,MAAMC,uBAAuB,GAAG;EAC9BC,KAAK,EAAGZ,CAAC,IAAKA,CAAC,CAACa,IAAI,CAACC,IAAI;EACzBC,KAAK,EAAE,CAAC;IAAEtC,KAAK,EAAE;EAAO,CAAE;CAC3B;AAUD,MAAMuC,aAAa,GAAGA,CAACH,IAAI,EAAEI,MAAkB,EAAE7B,MAAM,KAAI;EACzD,MAAM;IAAEF;EAAK,CAAE,GAAGE,MAAM;EACxB,MAAM8B,IAAI,GAAGhD,OAAO,CAAC2C,IAAI,CAAC,GACtB1C,QAAQ,EAAE,CAACgD,IAAI,CAACF,MAAM,CAACE,IAAI,CAAC,CAACN,IAAI,CAAC,GAClCzC,SAAS,CAACyC,IAAI,CAAC;EACnB3B,KAAK,GAAGgC,IAAI,CAACE,GAAG,CAAEpB,CAAC,IAAKvB,KAAK,CAACS,KAAK,CAAC,CAACc,CAAC,CAAC,CAAC,CAACjB,IAAI,CAACkC,MAAM,CAAClC,IAAI,CAAC,GAAGmC,IAAI,CAACG,KAAK,EAAE;EACzE;EACA/C,UAAU,EAAE,CAACO,IAAI,CAACoC,MAAM,CAACpC,IAAI,CAAC,CAACC,OAAO,CAACmC,MAAM,CAACnC,OAAO,CAAC,CAACoC,IAAI,CAAC;EAC5D,OAAOA,IAAI,CAACI,WAAW,EAAE;AAC3B,CAAC;AAID,OAAO,MAAMC,IAAI,GAAoBA,CAACC,WAAW,EAAEC,OAAO,KAAI;EAC5D,MAAM;IAAE9C,KAAK;IAAEC;EAAM,CAAE,GAAG6C,OAAO;EAEjC,MAAM;MACJZ,IAAI;MACJzB,MAAM,GAAG,EAAE;MACXI,KAAK,GAAG,EAAE;MACVK,KAAK,GAAG,EAAE;MACVoB,MAAM,GAAG,EAAE;MACXS,MAAM,GAAG,EAAE;MACXC,OAAO,GAAG;IAAE,IAEVH,WAAW;IADVI,UAAU,GAAAC,MAAA,CACXL,WAAW,EATT,mEASL,CAAc;EAEf,MAAMM,eAAe,GAAG3C,mBAAmB,CAACR,KAAK,EAAEC,MAAM,EAAEQ,MAAM,CAAC;EAElE,MAAM2C,eAAe,GAAGf,aAAa,CACnCH,IAAI,EACJ5C,OAAO,CAAC,EAAE,EAAES,0BAA0B,CAACC,KAAK,EAAEC,MAAM,CAAC,EAAEqC,MAAM,CAAC,EAC9DhD,OAAO,CAAC,EAAE,EAAE6D,eAAe,CAAC,QAAQ,CAAC,EAAE1C,MAAM,CAAC,CAC/C;EAED,MAAM4C,UAAU,GAAGzD,SAAS,CAACsB,KAAK,EAAE,OAAO,CAAC;EAE5C,OAAO5B,OAAO,CAAC,EAAE,EAAE6D,eAAe,EAAAG,MAAA,CAAAC,MAAA,CAAAD,MAAA,CAAAC,MAAA;IAChCrB,IAAI,EAAEkB,eAAe;IACrB3C,MAAM;IACNI,KAAK;IACLK,KAAK;IACL6B,MAAM,EAAE,C,gCAEDvB,qBAAqB,GACrB6B,UAAU,GAEf,GAAGN,MAAM;EACV,GACEE,UAAU;IACbD,OAAO,EAAEnD,YAAY,CAACmD,OAAO,EAAEhB,uBAAuB,CAAC;IACvDrB,IAAI,EAAE;EAAK,GACX;AACJ,CAAC;AAEDiC,IAAI,CAACY,KAAK,GAAG,EAAE","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}