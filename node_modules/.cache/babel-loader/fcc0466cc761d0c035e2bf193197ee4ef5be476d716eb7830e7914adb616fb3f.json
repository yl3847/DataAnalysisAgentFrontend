{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { clamp, isFunction } from '@antv/util';\nimport { CommonEvent } from '../constants';\nimport { parsePoint } from '../utils/point';\nimport { Shortcut } from '../utils/shortcut';\nimport { BaseBehavior } from './base-behavior';\n/**\n * <zh/> 缩放画布交互\n *\n * <en/> Zoom canvas behavior\n */\nexport class ZoomCanvas extends BaseBehavior {\n  constructor(context, options) {\n    super(context, Object.assign({}, ZoomCanvas.defaultOptions, options));\n    /**\n     * <zh/> 缩放画布\n     *\n     * <en/> Zoom canvas\n     * @param value - <zh/> 缩放值， > 0 放大， < 0 缩小 | <en/> Zoom value, > 0 zoom in, < 0 zoom out\n     * @param event - <zh/> 事件对象 | <en/> Event object\n     * @param animation - <zh/> 缩放动画配置 | <en/> Zoom animation configuration\n     */\n    this.zoom = (value, event, animation) => __awaiter(this, void 0, void 0, function* () {\n      if (!this.validate(event)) return;\n      const {\n        graph\n      } = this.context;\n      let origin = this.options.origin;\n      if (!origin && 'viewport' in event) {\n        origin = parsePoint(event.viewport);\n      }\n      const {\n        sensitivity,\n        onFinish\n      } = this.options;\n      const ratio = 1 + clamp(value, -50, 50) * sensitivity / 100;\n      const zoom = graph.getZoom();\n      yield graph.zoomTo(zoom * ratio, animation, origin);\n      onFinish === null || onFinish === void 0 ? void 0 : onFinish();\n    });\n    this.onReset = () => __awaiter(this, void 0, void 0, function* () {\n      yield this.context.graph.zoomTo(1, this.options.animation);\n    });\n    this.preventDefault = event => {\n      if (this.options.preventDefault) event.preventDefault();\n    };\n    this.shortcut = new Shortcut(context.graph);\n    this.bindEvents();\n  }\n  /**\n   * <zh/> 更新配置\n   *\n   * <en/> Update options\n   * @param options - <zh/> 配置项 | <en/> Options\n   * @internal\n   */\n  update(options) {\n    super.update(options);\n    this.bindEvents();\n  }\n  bindEvents() {\n    const {\n      trigger\n    } = this.options;\n    this.shortcut.unbindAll();\n    if (Array.isArray(trigger)) {\n      if (trigger.includes(CommonEvent.PINCH)) {\n        this.shortcut.bind([CommonEvent.PINCH], event => {\n          this.zoom(event.scale, event, false);\n        });\n      } else {\n        const container = this.context.canvas.getContainer();\n        container === null || container === void 0 ? void 0 : container.addEventListener(CommonEvent.WHEEL, this.preventDefault);\n        this.shortcut.bind([...trigger, CommonEvent.WHEEL], event => {\n          const {\n            deltaX,\n            deltaY\n          } = event;\n          this.zoom(-(deltaY !== null && deltaY !== void 0 ? deltaY : deltaX), event, false);\n        });\n      }\n    }\n    if (typeof trigger === 'object') {\n      const {\n        zoomIn = [],\n        zoomOut = [],\n        reset = []\n      } = trigger;\n      this.shortcut.bind(zoomIn, event => this.zoom(10, event, this.options.animation));\n      this.shortcut.bind(zoomOut, event => this.zoom(-10, event, this.options.animation));\n      this.shortcut.bind(reset, this.onReset);\n    }\n  }\n  /**\n   * <zh/> 验证是否可以缩放\n   *\n   * <en/> Verify whether it can be zoomed\n   * @param event - <zh/> 事件对象 | <en/> Event object\n   * @returns <zh/> 是否可以缩放 | <en/> Whether it can be zoomed\n   * @internal\n   */\n  validate(event) {\n    if (this.destroyed) return false;\n    const {\n      enable\n    } = this.options;\n    if (isFunction(enable)) return enable(event);\n    return !!enable;\n  }\n  /**\n   * <zh/> 销毁缩放画布\n   *\n   * <en/> Destroy zoom canvas\n   */\n  destroy() {\n    var _a;\n    this.shortcut.destroy();\n    (_a = this.context.canvas.getContainer()) === null || _a === void 0 ? void 0 : _a.removeEventListener(CommonEvent.WHEEL, this.preventDefault);\n    super.destroy();\n  }\n}\nZoomCanvas.defaultOptions = {\n  animation: {\n    duration: 200\n  },\n  enable: true,\n  sensitivity: 1,\n  trigger: [],\n  preventDefault: true\n};","map":{"version":3,"names":["clamp","isFunction","CommonEvent","parsePoint","Shortcut","BaseBehavior","ZoomCanvas","constructor","context","options","Object","assign","defaultOptions","zoom","value","event","animation","__awaiter","validate","graph","origin","viewport","sensitivity","onFinish","ratio","getZoom","zoomTo","onReset","preventDefault","shortcut","bindEvents","update","trigger","unbindAll","Array","isArray","includes","PINCH","bind","scale","container","canvas","getContainer","addEventListener","WHEEL","deltaX","deltaY","zoomIn","zoomOut","reset","destroyed","enable","destroy","_a","removeEventListener","duration"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/g6/src/behaviors/zoom-canvas.ts"],"sourcesContent":["import { clamp, isFunction } from '@antv/util';\nimport { CommonEvent } from '../constants';\nimport type { RuntimeContext } from '../runtime/types';\nimport type {\n  IKeyboardEvent,\n  IPointerEvent,\n  IWheelEvent,\n  Point,\n  PointObject,\n  ViewportAnimationEffectTiming,\n} from '../types';\nimport { parsePoint } from '../utils/point';\nimport type { ShortcutKey } from '../utils/shortcut';\nimport { Shortcut } from '../utils/shortcut';\nimport type { BaseBehaviorOptions } from './base-behavior';\nimport { BaseBehavior } from './base-behavior';\n\n/**\n * <zh/> 缩放画布交互配置项\n *\n * <en/> Zoom canvas behavior options\n */\nexport interface ZoomCanvasOptions extends BaseBehaviorOptions {\n  /**\n   * <zh/> 是否启用缩放动画\n   *\n   * <en/> Whether to enable the animation of zooming\n   * @defaultValue '{ duration: 200 }'\n   */\n  animation?: ViewportAnimationEffectTiming;\n  /**\n   * <zh/> 是否启用缩放画布的功能\n   *\n   * <en/> Whether to enable the function of zooming the canvas\n   * @defaultValue true\n   */\n  enable?: boolean | ((event: IWheelEvent | IKeyboardEvent | IPointerEvent) => boolean);\n  /**\n   * <zh/> 缩放中心点(视口坐标)\n   * - 默认情况下为鼠标位置中心\n   *\n   * <en/> zoom center(viewport coordinates)\n   * - by default , the center is the mouse position center\n   */\n  origin?: Point;\n  /**\n   * <zh/> 触发缩放的方式\n   * - ShortcutKey：组合快捷键，**默认使用滚轮缩放**，['Control'] 表示按住 Control 键滚动鼠标滚轮时触发缩放\n   * - CombinationKey：缩放快捷键，例如 { zoomIn: ['Control', '+'], zoomOut: ['Control', '-'], reset: ['Control', '0'] }\n   *\n   * <en/> The way to trigger zoom\n   * - ShortcutKey: Combination shortcut key, **default to zoom with the mouse wheel**, ['Control'] means zooming when holding down the Control key and scrolling the mouse wheel\n   * - CombinationKey: Zoom shortcut key, such as { zoomIn: ['Control', '+'], zoomOut: ['Control', '-'], reset: ['Control', '0'] }\n   */\n  trigger?:\n    | ShortcutKey\n    | {\n        zoomIn: ShortcutKey;\n        zoomOut: ShortcutKey;\n        reset: ShortcutKey;\n      };\n  /**\n   * <zh/> 缩放灵敏度\n   *\n   * <en/> Zoom sensitivity\n   * @defaultValue 1\n   */\n  sensitivity?: number;\n  /**\n   * <zh/> 完成缩放时的回调\n   *\n   * <en/> Callback when zooming is completed\n   */\n  onFinish?: () => void;\n  /**\n   * <zh/> 是否阻止默认事件\n   *\n   * <en/> Whether to prevent the default event\n   * @defaultValue true\n   */\n  preventDefault?: boolean;\n}\n\n/**\n * <zh/> 缩放画布交互\n *\n * <en/> Zoom canvas behavior\n */\nexport class ZoomCanvas extends BaseBehavior<ZoomCanvasOptions> {\n  static defaultOptions: Partial<ZoomCanvasOptions> = {\n    animation: { duration: 200 },\n    enable: true,\n    sensitivity: 1,\n    trigger: [],\n    preventDefault: true,\n  };\n\n  private shortcut: Shortcut;\n\n  constructor(context: RuntimeContext, options: ZoomCanvasOptions) {\n    super(context, Object.assign({}, ZoomCanvas.defaultOptions, options));\n\n    this.shortcut = new Shortcut(context.graph);\n\n    this.bindEvents();\n  }\n\n  /**\n   * <zh/> 更新配置\n   *\n   * <en/> Update options\n   * @param options - <zh/> 配置项 | <en/> Options\n   * @internal\n   */\n  public update(options: Partial<ZoomCanvasOptions>): void {\n    super.update(options);\n    this.bindEvents();\n  }\n\n  private bindEvents() {\n    const { trigger } = this.options;\n    this.shortcut.unbindAll();\n\n    if (Array.isArray(trigger)) {\n      if (trigger.includes(CommonEvent.PINCH)) {\n        this.shortcut.bind([CommonEvent.PINCH], (event) => {\n          this.zoom(event.scale, event, false);\n        });\n      } else {\n        const container = this.context.canvas.getContainer();\n        container?.addEventListener(CommonEvent.WHEEL, this.preventDefault);\n        this.shortcut.bind([...trigger, CommonEvent.WHEEL], (event) => {\n          const { deltaX, deltaY } = event;\n          this.zoom(-(deltaY ?? deltaX), event, false);\n        });\n      }\n    }\n\n    if (typeof trigger === 'object') {\n      const {\n        zoomIn = [],\n        zoomOut = [],\n        reset = [],\n      } = trigger as {\n        zoomIn: ShortcutKey;\n        zoomOut: ShortcutKey;\n        reset: ShortcutKey;\n      };\n      this.shortcut.bind(zoomIn, (event) => this.zoom(10, event, this.options.animation));\n      this.shortcut.bind(zoomOut, (event) => this.zoom(-10, event, this.options.animation));\n      this.shortcut.bind(reset, this.onReset);\n    }\n  }\n\n  /**\n   * <zh/> 缩放画布\n   *\n   * <en/> Zoom canvas\n   * @param value - <zh/> 缩放值， > 0 放大， < 0 缩小 | <en/> Zoom value, > 0 zoom in, < 0 zoom out\n   * @param event - <zh/> 事件对象 | <en/> Event object\n   * @param animation - <zh/> 缩放动画配置 | <en/> Zoom animation configuration\n   */\n  protected zoom = async (\n    value: number,\n    event: IWheelEvent | IKeyboardEvent | IPointerEvent,\n    animation: ZoomCanvasOptions['animation'],\n  ) => {\n    if (!this.validate(event)) return;\n    const { graph } = this.context;\n\n    let origin: Point | undefined = this.options.origin;\n    if (!origin && 'viewport' in event) {\n      origin = parsePoint(event.viewport as PointObject);\n    }\n\n    const { sensitivity, onFinish } = this.options;\n    const ratio = 1 + (clamp(value, -50, 50) * sensitivity) / 100;\n    const zoom = graph.getZoom();\n    await graph.zoomTo(zoom * ratio, animation, origin);\n\n    onFinish?.();\n  };\n\n  protected onReset = async () => {\n    await this.context.graph.zoomTo(1, this.options.animation);\n  };\n\n  /**\n   * <zh/> 验证是否可以缩放\n   *\n   * <en/> Verify whether it can be zoomed\n   * @param event - <zh/> 事件对象 | <en/> Event object\n   * @returns <zh/> 是否可以缩放 | <en/> Whether it can be zoomed\n   * @internal\n   */\n  protected validate(event: IWheelEvent | IKeyboardEvent | IPointerEvent) {\n    if (this.destroyed) return false;\n    const { enable } = this.options;\n    if (isFunction(enable)) return enable(event);\n    return !!enable;\n  }\n\n  private preventDefault = (event: Event) => {\n    if (this.options.preventDefault) event.preventDefault();\n  };\n\n  /**\n   * <zh/> 销毁缩放画布\n   *\n   * <en/> Destroy zoom canvas\n   */\n  public destroy() {\n    this.shortcut.destroy();\n    this.context.canvas.getContainer()?.removeEventListener(CommonEvent.WHEEL, this.preventDefault);\n    super.destroy();\n  }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}