{"ast":null,"code":"import { throttle, deepMix } from '@antv/util';\nimport { selectPlotArea, mousePosition } from './utils';\nfunction maybeCoordinate(options) {\n  const {\n    coordinate = {}\n  } = options;\n  const {\n    transform = []\n  } = coordinate;\n  const fisheye = transform.find(d => d.type === 'fisheye');\n  if (fisheye) return fisheye;\n  const newFisheye = {\n    type: 'fisheye'\n  };\n  transform.push(newFisheye);\n  coordinate.transform = transform;\n  options.coordinate = coordinate;\n  return newFisheye;\n}\n/**\n * @todo Bind abstract data or data index.\n */\nexport function Fisheye({\n  wait = 30,\n  leading,\n  trailing = false\n}) {\n  return context => {\n    const {\n      options,\n      update,\n      setState,\n      container\n    } = context;\n    const plotArea = selectPlotArea(container);\n    const updateFocus = throttle(event => {\n      const focus = mousePosition(plotArea, event);\n      if (!focus) {\n        setState('fisheye');\n        update();\n        return;\n      }\n      setState('fisheye', options => {\n        // Clone options and mutate it.\n        // Disable animation.\n        const clonedOptions = deepMix({}, options, {\n          interaction: {\n            tooltip: {\n              preserve: true\n            }\n          }\n        });\n        for (const mark of clonedOptions.marks) mark.animate = false;\n        const [x, y] = focus;\n        const fisheye = maybeCoordinate(clonedOptions);\n        fisheye.focusX = x;\n        fisheye.focusY = y;\n        fisheye.visual = true;\n        return clonedOptions;\n      });\n      update();\n    }, wait, {\n      leading,\n      trailing\n    });\n    // Bind events.\n    plotArea.addEventListener('pointerenter', updateFocus);\n    plotArea.addEventListener('pointermove', updateFocus);\n    plotArea.addEventListener('pointerleave', updateFocus);\n    return () => {\n      plotArea.removeEventListener('pointerenter', updateFocus);\n      plotArea.removeEventListener('pointermove', updateFocus);\n      plotArea.removeEventListener('pointerleave', updateFocus);\n    };\n  };\n}","map":{"version":3,"names":["throttle","deepMix","selectPlotArea","mousePosition","maybeCoordinate","options","coordinate","transform","fisheye","find","d","type","newFisheye","push","Fisheye","wait","leading","trailing","context","update","setState","container","plotArea","updateFocus","event","focus","clonedOptions","interaction","tooltip","preserve","mark","marks","animate","x","y","focusX","focusY","visual","addEventListener","removeEventListener"],"sources":["/Users/yizelu/Desktop/mcp/frontend/node_modules/@antv/g2/src/interaction/fisheye.ts"],"sourcesContent":["import { throttle, deepMix } from '@antv/util';\nimport { selectPlotArea, mousePosition } from './utils';\n\nfunction maybeCoordinate(options) {\n  const { coordinate = {} } = options;\n  const { transform = [] } = coordinate;\n  const fisheye = transform.find((d) => d.type === 'fisheye');\n  if (fisheye) return fisheye;\n  const newFisheye = { type: 'fisheye' };\n  transform.push(newFisheye);\n  coordinate.transform = transform;\n  options.coordinate = coordinate;\n  return newFisheye;\n}\n\n/**\n * @todo Bind abstract data or data index.\n */\nexport function Fisheye({\n  wait = 30,\n  leading,\n  trailing = false,\n}: Record<string, any>) {\n  return (context) => {\n    const { options, update, setState, container } = context;\n    const plotArea = selectPlotArea(container);\n\n    const updateFocus = throttle(\n      (event) => {\n        const focus = mousePosition(plotArea, event);\n        if (!focus) {\n          setState('fisheye');\n          update();\n          return;\n        }\n        setState('fisheye', (options) => {\n          // Clone options and mutate it.\n          // Disable animation.\n          const clonedOptions = deepMix({}, options, {\n            interaction: { tooltip: { preserve: true } },\n          });\n          for (const mark of clonedOptions.marks) mark.animate = false;\n          const [x, y] = focus;\n          const fisheye = maybeCoordinate(clonedOptions);\n          fisheye.focusX = x;\n          fisheye.focusY = y;\n          fisheye.visual = true;\n          return clonedOptions;\n        });\n        update();\n      },\n      wait,\n      { leading, trailing },\n    ) as (...args: any[]) => void;\n\n    // Bind events.\n    plotArea.addEventListener('pointerenter', updateFocus);\n    plotArea.addEventListener('pointermove', updateFocus);\n    plotArea.addEventListener('pointerleave', updateFocus);\n\n    return () => {\n      plotArea.removeEventListener('pointerenter', updateFocus);\n      plotArea.removeEventListener('pointermove', updateFocus);\n      plotArea.removeEventListener('pointerleave', updateFocus);\n    };\n  };\n}\n"],"mappings":"AAAA,SAASA,QAAQ,EAAEC,OAAO,QAAQ,YAAY;AAC9C,SAASC,cAAc,EAAEC,aAAa,QAAQ,SAAS;AAEvD,SAASC,eAAeA,CAACC,OAAO;EAC9B,MAAM;IAAEC,UAAU,GAAG;EAAE,CAAE,GAAGD,OAAO;EACnC,MAAM;IAAEE,SAAS,GAAG;EAAE,CAAE,GAAGD,UAAU;EACrC,MAAME,OAAO,GAAGD,SAAS,CAACE,IAAI,CAAEC,CAAC,IAAKA,CAAC,CAACC,IAAI,KAAK,SAAS,CAAC;EAC3D,IAAIH,OAAO,EAAE,OAAOA,OAAO;EAC3B,MAAMI,UAAU,GAAG;IAAED,IAAI,EAAE;EAAS,CAAE;EACtCJ,SAAS,CAACM,IAAI,CAACD,UAAU,CAAC;EAC1BN,UAAU,CAACC,SAAS,GAAGA,SAAS;EAChCF,OAAO,CAACC,UAAU,GAAGA,UAAU;EAC/B,OAAOM,UAAU;AACnB;AAEA;;;AAGA,OAAM,SAAUE,OAAOA,CAAC;EACtBC,IAAI,GAAG,EAAE;EACTC,OAAO;EACPC,QAAQ,GAAG;AAAK,CACI;EACpB,OAAQC,OAAO,IAAI;IACjB,MAAM;MAAEb,OAAO;MAAEc,MAAM;MAAEC,QAAQ;MAAEC;IAAS,CAAE,GAAGH,OAAO;IACxD,MAAMI,QAAQ,GAAGpB,cAAc,CAACmB,SAAS,CAAC;IAE1C,MAAME,WAAW,GAAGvB,QAAQ,CACzBwB,KAAK,IAAI;MACR,MAAMC,KAAK,GAAGtB,aAAa,CAACmB,QAAQ,EAAEE,KAAK,CAAC;MAC5C,IAAI,CAACC,KAAK,EAAE;QACVL,QAAQ,CAAC,SAAS,CAAC;QACnBD,MAAM,EAAE;QACR;;MAEFC,QAAQ,CAAC,SAAS,EAAGf,OAAO,IAAI;QAC9B;QACA;QACA,MAAMqB,aAAa,GAAGzB,OAAO,CAAC,EAAE,EAAEI,OAAO,EAAE;UACzCsB,WAAW,EAAE;YAAEC,OAAO,EAAE;cAAEC,QAAQ,EAAE;YAAI;UAAE;SAC3C,CAAC;QACF,KAAK,MAAMC,IAAI,IAAIJ,aAAa,CAACK,KAAK,EAAED,IAAI,CAACE,OAAO,GAAG,KAAK;QAC5D,MAAM,CAACC,CAAC,EAAEC,CAAC,CAAC,GAAGT,KAAK;QACpB,MAAMjB,OAAO,GAAGJ,eAAe,CAACsB,aAAa,CAAC;QAC9ClB,OAAO,CAAC2B,MAAM,GAAGF,CAAC;QAClBzB,OAAO,CAAC4B,MAAM,GAAGF,CAAC;QAClB1B,OAAO,CAAC6B,MAAM,GAAG,IAAI;QACrB,OAAOX,aAAa;MACtB,CAAC,CAAC;MACFP,MAAM,EAAE;IACV,CAAC,EACDJ,IAAI,EACJ;MAAEC,OAAO;MAAEC;IAAQ,CAAE,CACM;IAE7B;IACAK,QAAQ,CAACgB,gBAAgB,CAAC,cAAc,EAAEf,WAAW,CAAC;IACtDD,QAAQ,CAACgB,gBAAgB,CAAC,aAAa,EAAEf,WAAW,CAAC;IACrDD,QAAQ,CAACgB,gBAAgB,CAAC,cAAc,EAAEf,WAAW,CAAC;IAEtD,OAAO,MAAK;MACVD,QAAQ,CAACiB,mBAAmB,CAAC,cAAc,EAAEhB,WAAW,CAAC;MACzDD,QAAQ,CAACiB,mBAAmB,CAAC,aAAa,EAAEhB,WAAW,CAAC;MACxDD,QAAQ,CAACiB,mBAAmB,CAAC,cAAc,EAAEhB,WAAW,CAAC;IAC3D,CAAC;EACH,CAAC;AACH","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}